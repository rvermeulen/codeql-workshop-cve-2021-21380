/** Exercise 6: Extend the `RemoteFlowSource`'s value set with the parameters of the public methods of the component classes identified in exercise 3. */

import java
import semmle.code.java.dataflow.FlowSources

module XWiki {
  class Component extends Class {
    Component() {
      this.getAnAnnotation()
          .getType()
          .hasQualifiedName("org.xwiki.component.annotation", "Component")
    }
  }

  class ScriptComponent extends Component {
    ScriptComponent() { this.getASupertype().hasName("ScriptService") }
  }

  class ScriptComponentMethodParameterSource extends RemoteFlowSource {
    ScriptComponentMethodParameterSource() {
      exists(
        ScriptComponent scriptComponent, Method apiMethod // FROM
      |
        scriptComponent.getAMethod() = apiMethod and // WHERE
        apiMethod.isPublic() and
        apiMethod.getAParameter() = this.asParameter()
      )
    }

    override string getSourceType() { result = "XWiki component method parameter" }
  }
}

select any(RemoteFlowSource s)
